cargo-features = ["resolver"]

[workspace]
members = [
    "abi",
    "demo",
    "demo-stm32h7",
    "lpc55",
    "kern",
    "userlib",

    "xtask",

    "task-template",

    "task-jefe",
    "task-ping",
    "task-pong",
    "task-idle",
    "task-spam2",

    "drv/stm32f4-rcc",
    "drv/stm32f4-usart",

    "drv/stm32h7-gpio",
    "drv/stm32h7-gpio-api",
    "drv/stm32h7-rcc",
    "drv/stm32h7-usart",

    "drv/lpc55-syscon",
    "drv/lpc55-syscon-api",
    "drv/lpc55-gpio",
    "drv/lpc55-usart",
    "drv/lpc55-i2c",

    "drv/user-leds",
    "drv/user-leds-api",

    "tests-stm32f4/stub",
    "tests-stm32f4",
]
default-members = []
resolver = "2"

[patch.crates-io]
#
# Until https://github.com/rust-embedded/cortex-m/pull/227 is pulled into
# a cortex-m release, we ned to pull from the Oxide branch with the fix.
#
cortex-m = { git = "https://github.com/oxidecomputer/cortex-m.git", branch = "itm-reserved-bits" }

[profile.release]
codegen-units = 1 # better optimizations
debug = true # symbols are nice and they don't increase the size on Flash
lto = true # better optimizations
opt-level = "z" # smaller optimizations

[profile.dev]
opt-level = 1 # no optimizations was just too painful in terms of flash size
